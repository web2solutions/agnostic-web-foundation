<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>voodux Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top navbar-inverse">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">voodux</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="modules.list.html" class="dropdown-toggle" data-toggle="dropdown">Modules<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="module-utils.html">utils</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="DataEntity.html">DataEntity</a></li><li><a href="Foundation.html">Foundation</a></li><li><a href="LocalDatabaseTransport.html">LocalDatabaseTransport</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			

	
	











	
	





    <section class="readme-section">
        <article><p><a href="./index.html"><img src="https://i.imgur.com/a856gth.png" width="400" /></a></p>
<p><a href="https://circleci.com/gh/web2solutions/voodux/tree/main"><img src="https://circleci.com/gh/web2solutions/voodux/tree/main.svg?style=svg&amp;circle-token=9d237bc24e3336b97f53ab9626f8a2ceb6f230b3" alt="CircleCI"></a> | <a href="https://circleci.com/gh/web2solutions/voodux/tree/release"><img src="https://circleci.com/gh/web2solutions/voodux/tree/release.svg?style=svg&amp;circle-token=9d237bc24e3336b97f53ab9626f8a2ceb6f230b3" alt="CircleCI"></a> | <a href="https://circleci.com/gh/web2solutions/voodux/tree/develop"><img src="https://circleci.com/gh/web2solutions/voodux/tree/develop.svg?style=svg&amp;circle-token=9d237bc24e3336b97f53ab9626f8a2ceb6f230b3" alt="CircleCI"></a> | <a href="https://codecov.io/gh/web2solutions/voodux"><img src="https://codecov.io/gh/web2solutions/voodux/branch/main/graph/badge.svg?token=3zGpnoRLdG" alt="codecov"></a> | <a href="https://snyk.io/test/github/web2solutions/voodux"><img src="https://snyk.io/test/github/web2solutions/voodux/badge.svg" alt="Known Vulnerabilities"></a> | <a href="https://opensource.org/licenses/MIT"><img src="https://img.shields.io/badge/License-MIT-yellow.svg" alt="License: MIT"></a></p>
<h1>VooduX</h1>
<h2>Summary</h2>
<p>VooduX is a proposal to cover some common lacks in modern web applications development.</p>
<p>It heavly opinionate on how to define a strong underlying architecture which relies mostly in <code>V-*</code> like libraries and frameworks such as <code>Vue</code> and <code>React</code>.</p>
<blockquote>
<p>One common sense in every engineering field is: <code>There is no single silver bullets for all existing problems</code>.</p>
<p>There is a giant race over <code>React</code> and <code>Vue</code>. They are likely the <code>V</code> in on a <code>MVC</code> like acronym. And in terms of <code>Project Standards</code>, that is all they care about.</p>
<p>They usualy try to solve <code>application data</code> issues, but their proposed solutions are mostly focused in the <code>application state</code> rather than the <code>application data</code>. They mainly rely on browser memory to keep chunks of data.</p>
<p>There is no problem on those solutions, not at least in a <code>project standard</code> perspective, because they ain't necessarily try to solve <code>M</code> related problems .</p>
<p>By mistake, developers and teams are mostly focusing on the <code>V</code> layer and ignoring a <code>possibly required</code> underlying foundation architecture. Which finally increases the code complexity of those <code>View</code> or <code>Component</code> layers, because they are trying to resolve problems that should not being handled in that domain.</p>
</blockquote>
<p><code>State Management</code> libraries are really great. But they don't works as an <code>Application Data Management</code> abstraction suposedly would do. Not sure if this last acronym exists, but I'm reffering to whole application data storage and it access. Simply because the <code>application data size</code> might considerable grows.</p>
<p>An <code>Application State Management</code> abstraction handles <code>pieces</code> of data that are curenlty being used in the screen at the present moment. But it does not means you could not have another pieces of data being <code>stored or handled</code> in parallel, behind the scenes.</p>
<p>Not least, <code>quick data persistence</code> is not enough. You may need to save your data to different locations, or sync multiple client applications, or even t handle a big amount of data on application startup.</p>
<p>This where VooduX comes in.</p>
<p>Let's make a simple comparison to quickly visualize the main difference between traditional React/Vue applications and a VooduX powered application:</p>
<hr>
<p><code>This is how a common React/Vue application looks like:</code></p>
<img src="https://i.imgur.com/acwNgqq.png" style="max-width: 900px;" />
<hr>
<p><code>This is how a VooduX powered React/Vue application looks like:</code></p>
<img src="https://i.imgur.com/FsxIaMl.png" style="max-width: 900px;" />
<hr>
<h4>Interactive code example</h4>
<p>Now let's see an interactive example:</p>
<p class="codepen" data-height="665" data-theme-id="dark" data-default-tab="js,result" data-user="web2solutions" data-slug-hash="MWbEMrb" style="height: 665px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="VooduX - VanillaJS playground">
  <span>See the Pen <a href="https://codepen.io/web2solutions/pen/MWbEMrb">
  VooduX - VanillaJS playground</a> by Eduardo Almeida (<a href="https://codepen.io/web2solutions">@web2solutions</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
<hr>
<h2>Install</h2>
<h3>Via npm - Simple usage</h3>
<pre class="prettyprint source lang-bash"><code>  $ npm install voodux --save
</code></pre>
<h3>Via git - Advanced usage</h3>
<pre class="prettyprint source lang-bash"><code>  $ git clone https://github.com/web2solutions/voodux.git
  $ cd voodux
  $ npm install
</code></pre>
<h2>How to use</h2>
<p>This the Step by Step guide to use VooduX</p>
<h3>Importing VooduX into your application</h3>
<p>The first step to use VooduX in your project it to import it library.</p>
<h4>Require</h4>
<pre class="prettyprint source lang-javascript"><code>  const voodux = require('voodux')

  const { 
    Foundation, 
    // LocalDatabaseTransport, 
    // DataEntity, 
    // utils 
  } = voodux
</code></pre>
<h4>ES6 import</h4>
<p>In order to import the main library to your project just simply import it:</p>
<pre class="prettyprint source lang-javascript"><code>  import voodux from 'voodux'
  const { 
    Foundation, 
    // LocalDatabaseTransport, 
    // DataEntity, 
    // utils 
  } = voodux
</code></pre>
<h4>Browser directly usage</h4>
<pre class="prettyprint source lang-html"><code>  &lt;script type=&quot;text/javascript&quot; src=&quot;voodux/dist/main.min.js&quot;>&lt;/script>
</code></pre>
<h4>React and Vue Project Structure</h4>
<p>This is how a hypotethical React or Vue project structure looks like. This example is assuming the fact that your application have 4 pages:</p>
<ol>
<li>Dashboard</li>
<li>Customers</li>
<li>Orders</li>
<li>Products</li>
</ol>
<pre class="prettyprint source lang-bash"><code>├── dist                          -> Final app code goes here
├── docs
│ ├── code                        -> JSDoc documentation will be saved here
│ └── reports                     -> Karma reports will be saved here
├── html_app                      -> Original static files
├── test                          -> Test suites goes here
├── src
│   ├── components
│   │   ├── customers
│   │   │   ├── CustomersAdd.js   -> Add form
│   │   │   ├── CustomersEdit.js  -> Edit form
│   │   │   ├── index.js          -> Main listing page
│   │   │   └── events            -> Event Handlers decoupled from component files
│   │   ├── dashboard
│   │   │   ├── Chart.js          -> Finance Chart
│   │   │   ├── index.js          -> Main listing page
│   │   │   └── events            -> Event Handlers decoupled from component files
│   │   ├── orders
│   │   │   ├── OrdersAdd.js      -> Add form
│   │   │   ├── index.js          -> Main listing page
│   │   │   └── events            -> Event Handlers decoupled from component files
│   │   ├── products
│   │   │   ├── ProductsAdd.js    -> Add form
│   │   │   ├── ProductsEdit.js   -> Edit form
│   │   │   ├── index.js          -> Main listing page
│   │   │   └── events            -> Event Handlers decoupled from component files
│   ├── events                    -> Decoupled Application Event handlers
│   ├── schemas                   -> Data Entity Schemas (or Data Models) are saved here
│   ├── App.css
│   ├── App.js                    -> React/Vue Application code
│   └── main.js                   -> Application entry point
├── test
├── .babelrc                      -> Babel configuration
├── .eslintignore                 -> eslint ignore rules
├── .eslintrc.json                -> eslint configuration
├── .prettierrc                   -> prettier configuration
├── jsDoc.json                    -> JSDoc configuration
├── package.json
└── webpack.config.js              -> webpack configuration
</code></pre>
<h3>Writing your application code</h3>
<p>The underlying architecture of every VooduX application borns in it <code>Data Design</code>.</p>
<p>The VooduX strongly believes that the <code>Data plan</code> and <code>Data design</code> is the first step to take when building successful projects. That is why we start by defining some <code>Data Schemas</code> for the <code>Data entities</code> we have in the system.</p>
<p>Every Data entity in the system has it own encapsulated methods to access, handle and notify data changes to every actor listening to it.
Schemas must be provided in the foundation constructor or at least pior calling the <a href="https://web2solutions.github.io/voodux/code/Foundation.html#.start__anchor"><code>foundation.start()</code></a> method. Otherwise it collection will not be created inside the local database.</p>
<h4>Setup a data schema for a Data Entity</h4>
<p>Every <code>Data Schema</code> in a <code>VooduX</code> application is set using the <a href="https://web2solutions.github.io/voodux/code/Foundation.html#.Schema__anchor"><code>Foundation.Schema(schema)</code></a> static method.</p>
<p>The data schemas are set following the <a href="https://mongoosejs.com/docs/guide.html"><code>Mongoose</code></a> standard to define schemas. It means you are not repeating yourself when writing data schemas because they targets both the <code>front end</code> and <code>back end</code>. In other words, server and client data are being defined by a single contract.</p>
<pre class="prettyprint source lang-javascript"><code>import voodux from 'voodux'
const { Foundation, LocalDatabaseTransport, DataEntity, utils } = voodux

const CustomerSchema = new Foundation.Schema({
  name: {
    type: String,
    required: true,
    index: true
  },
  address: {
    type: String,
    required: true,
    index: true
  },
  email: {
    type: String,
    required: true,
    index: true
  },
  cards: {
    type: [],
    required: true
  }
})
</code></pre>
<h4>Foundation constructor</h4>
<p>The starting point of every <code>voodux</code> application is it <code>Foundation</code>.</p>
<p>The application foundation holds things like data definition, data access, data validation, data persistence, data change notification ....</p>
<p>Prior starting your React or Vue application code, you must create your <code>application foundation</code> and then to pass it as property to your React or Vue application.</p>
<p>The <code>application foundation</code> is set by calling the <code>Foundation constructor</code>.</p>
<pre class="prettyprint source lang-javascript"><code>  const foundation = new Foundation({
      name: 'My App',
      schemas: {
          User: UserSchema,
          Product: ProductSchema,
          Order: OrderSchema,
          Customer: CustomerSchema
      }
  })
</code></pre>
<h4>Listening to <code>Application Start</code> event</h4>
<p>Sometimes you may need to start executing heavy tasks prior start rendering your application screens. For example you could start a data sync process, starting to fill out you local database and in meantime, render a dashboard and start rendering data changes in realtime, as long as they are <code>emitted</code> from the Data Entity abstraction implementation.</p>
<p>The <code>foundation:start</code> event listener must be set before calling <code>foundation.start()</code>. Otherwise it will not be triggered.</p>
<pre class="prettyprint source lang-javascript"><code>    foundation.on('foundation:start', async function(eventObj) {
      const {
          foundation,
          error
      } = eventObj
      if (error) {
          throw new Error(`Error starting foundation stack: ${error}`)
      }
      const {
          User,
          Product
      } = foundation.data
      const Eduardo = await User.add({
          name: 'Eduardo Almeida',
          username: 'web2'
      })
      console.debug('Eduardo', Eduardo)

      const Volvo = await Product.add({
          name: 'Volvo XC90',
          vendor: 'Volvo',
          price_cost: 150000
      })
      console.debug('Volvo', Volvo)
  })
</code></pre>
<h4>Hypothetical full React app setup demo</h4>
<pre class="prettyprint source lang-javascript"><code>  // import React lib
  import React from 'react'
  
  // import voodux
  import voodux from 'voodux'
  const { Foundation, LocalDatabaseTransport, DataEntity, utils } = voodux

  // setup Data schemas
  const CustomerSchema = new Foundation.Schema({
    name: {
        type: String,
        required: true,
        index: true
    },
    address: {
        type: String,
        required: true,
        index: true
    },
    email: {
        type: String,
        required: true,
        index: true
    },
    cards: {
        type: [],
        required: true
    }
  })

  const OrderSchema = new Foundation.Schema({
      name: {
          type: String,
          required: true,
          index: true
      },
      shipTo: {
          type: String,
          required: true,
          index: true
      },
      paymentMethod: {
          type: String,
          required: true,
          index: true
      },
      amount: {
          type: Number,
          required: true,
          default: 0,
          index: true
      },
      date: {
          type: Date,
          default: Date.now,
          index: true
      }
  })

  const ProductSchema = new Foundation.Schema({
      name: {
          type: String,
          required: true,
          index: true
      },
      vendor: {
          type: String,
          required: true,
          index: true
      },
      price_cost: {
          type: Number,
          required: true,
          default: 0,
          index: true
      }
  })

  const UserSchema = new Foundation.Schema({
      name: {
          type: String,
          required: true
      },
      username: {
          type: String,
          required: true
      }
  })

  const foundation = new Foundation({
      name: 'My App',
      useWorker: true,
      dataStrategy: 'offlineFirst',
      schemas: {
          User: UserSchema,
          Product: ProductSchema,
          Order: OrderSchema,
          Customer: CustomerSchema
      }
  })

  // listen to application start event and add some records to database.
  foundation.on('foundation:start', async function(eventObj) {
      const {
          foundation,
          error
      } = eventObj
      if (error) {
          throw new Error(`Error starting foundation stack: ${error}`)
      }
      const {
          User,
          Product
      } = foundation.data
      const Eduardo = await User.add({
          name: 'Eduardo Almeida',
          username: 'web2'
      })
      console.debug('Eduardo', Eduardo)

      const Volvo = await Product.add({
          name: 'Volvo XC90',
          vendor: 'Volvo',
          price_cost: 150000
      })
      console.debug('Volvo', Volvo)
  })

  // start application foundation and get it ready to be used
  const start = await foundation.start()
  if (start.error) {
      throw new Error(`Error starting foundation stack: ${start.error}`)
  }
  
  // start rendering yout React application by passing the application foundation as it prop.
  ReactDOM.render(
    &lt;App foundation={foundation} />,
    document.getElementById('root')
  )

</code></pre>
<h4>Hypothetical React <code>Customers Listing</code> component</h4>
<p>This component does render a list of Customers.</p>
<p>On the list, every listed customer has associated <code>delete</code> and <code>update</code> links.</p>
<p>The component has an array of <code>customers</code> as main state property.</p>
<p>Ok, there is nothing new here!</p>
<p>The <code>dirty magic</code> begins when the requirement list starting asking for things like:</p>
<ul>
<li>To be able to show the same data in the screen after browser refreshing <code>and do not</code> call the server API asking for those specific piece of data.</li>
<li>Have a reliable and high performance <code>2-way dataflow</code> model between <code>Application Data Storage and Application State Manager</code>.</li>
</ul>
<pre class="prettyprint source lang-javascript"><code>// pages/orders.js
import React, { useState, useEffect, useContext } from 'react'
import { Link, useHistory } from 'react-router-dom'
import Grid from '@material-ui/core/Grid'
import Paper from '@material-ui/core/Paper'
import Table from '@material-ui/core/Table'
import TableBody from '@material-ui/core/TableBody'
import TableCell from '@material-ui/core/TableCell'
import TableHead from '@material-ui/core/TableHead'
import TableRow from '@material-ui/core/TableRow'
// import Link from '@material-ui/core/Link'
import Button from '@material-ui/core/Button'
import ButtonGroup from '@material-ui/core/ButtonGroup'
import useStyles from './useStyles'

import swal from 'sweetalert'

import FoundationContext from '../FoundationContext'


import Title from './Title'

// import custom hooks
import onAddDocHook from './hooks/onAddDocHook'
import onEditDocHook from './hooks/onEditDocHook'
import onDeleteDocHook from './hooks/onDeleteDocHook'



export default function Customers () {
  const [customers, setCustomers] = useState([])
  const foundation = useContext(FoundationContext)

  const { Customer } = foundation.data
  const [newDoc] = onAddDocHook(Customer)
  const [editedDoc] = onEditDocHook(Customer)
  const [deletedDoc] = onDeleteDocHook(Customer)
  
  const history = useHistory()
  const classes = useStyles()

  const handleAddCustomer = (e) => {
    e.preventDefault()
    history.push('/CustomersAdd')
  }

  const handleDeleteCustomer = async (e, ___id) => {
    e.preventDefault()
    // console.error(___id)
    swal({
      title: 'Are you sure?',
      text: 'Once deleted, you will not be able to recover this!',
      icon: 'warning',
      buttons: true,
      dangerMode: true
    }).then(async (willDelete) => {
      if (willDelete) {
        const r = await Customer.delete(___id)
        // console.error(r)
        if (r.error) {
          swal('Database error', e.error.message, 'error')
          return
        }
        swal('Poof! The customer has been deleted!', {
          icon: 'success'
        })
      } else {
        swal('The Customer is safe!')
      }
    })
  }


  // whatch for new docs
  useEffect(() => {
    if (newDoc !== null) {
      console.log('newDoc mudou', newDoc)
      setCustomers([newDoc, ...customers])
      console.log('customers', customers)
    }
  }, [newDoc]) 

  // watch for edited docs
  useEffect(() => {
    if (editedDoc !== null) {
      console.log('editedDoc mudou', editedDoc)
      const newData = customers.map((customer) => {
        if (customer.__id === editedDoc.__id) {
          return editedDoc
        } else {
          return customer
        }
      })
      setCustomers([...newData])
      console.log('customers', customers)
    }
  }, [editedDoc])

  // watch for deleted docs
  useEffect(() => {
    if (deletedDoc !== null) {

      const allCustomers = [...customers]
      for (let x = 0; x &lt; allCustomers.length; x++) {
        const customer = allCustomers[x]
        if (customer.__id === deletedDoc.__id) {
          allCustomers.splice(x, 1)
        }
      }
      setCustomers(allCustomers)
    }
  }, [deletedDoc]) 

  useEffect(() => {
    async function findCustomers() {
      const findCustomers = await Customer.find({})
      if (!findCustomers) {
        return
      }
      if (findCustomers.data) {
        setCustomers(findCustomers.data)
      }
    }
    console.log('finding')
    if (customers.length === 0) {
      findCustomers()
    }
  }, [customers])
  


  return (
    &lt;>
      &lt;Grid container spacing={3}>
        &lt;Grid item xs={12}>
          &lt;Paper className={classes.paper}>
            &lt;Title>Customers&lt;/Title>
            &lt;ButtonGroup color='primary' aria-label='outlined primary button group'>
              &lt;Button onClick={handleAddCustomer}>Add&lt;/Button>
            &lt;/ButtonGroup>
            &lt;Table size='small'>
              &lt;TableHead>
                &lt;TableRow>
                  &lt;TableCell>Name&lt;/TableCell>
                  &lt;TableCell>E-mail&lt;/TableCell>
                  &lt;TableCell>Address&lt;/TableCell>
                  &lt;TableCell>Cards&lt;/TableCell>
                  &lt;TableCell align='right'>actions&lt;/TableCell>
                &lt;/TableRow>
              &lt;/TableHead>
              &lt;TableBody>
                {customers.map((customer) => (
                  &lt;TableRow key={customer.id}>
                    &lt;TableCell>{customer.name}&lt;/TableCell>
                    &lt;TableCell>{customer.email}&lt;/TableCell>
                    &lt;TableCell>{customer.address}&lt;/TableCell>
                    &lt;TableCell align='right'>{customer.cards.join(' / ')}&lt;/TableCell>
                    &lt;TableCell align='right'>
                      &lt;Link color='primary' to={`/CustomersEdit/${customer.__id}`}>[edit]&lt;/Link> | &lt;a color='primary' href='#' onClick={e => handleDeleteCustomer(e, customer.__id)}>[delete]&lt;/a>
                    &lt;/TableCell>
                  &lt;/TableRow>
                ))}
              &lt;/TableBody>
            &lt;/Table>
            &lt;div className={classes.seeMore}> Paging goes here &lt;/div>
          &lt;/Paper>
        &lt;/Grid>
      &lt;/Grid>
    &lt;/>
  )
}
</code></pre>
<h5>The hooks:</h5>
<p><code>onAddDocHook</code></p>
<pre class="prettyprint source lang-javascript"><code>// onAddDocHook.js

import React from 'react'

const onAddDocHook = (Model) => {
  const [newDoc, newDocSet] = React.useState(null)
  let onAddDocEventListener = null

  React.useEffect(() => {
    if (newDoc === null) {
      onAddDocEventListener = Model.on('add', (eventObj) => {
        const { error, /* document, foundation, */ data } = eventObj
        if (error) {
          return
        }
        newDocSet(data)
      })
    }
  }, [newDoc])

  React.useEffect(() => {
    return () => {
      // stop to listen events on component unmount
      Model.stopListenTo(onAddDocEventListener)
      onAddDocEventListener = null
    }
  }, [])

  return [newDoc]
}

export default onAddDocHook

</code></pre>
<p><code>onEditDocHook</code></p>
<pre class="prettyprint source lang-javascript"><code>// onEditDocHook.js
import React from 'react'

const onEditDocHook = (Model) => {
  const [editedDoc, editedDocSet] = React.useState(null)
  let onEditDocEventListener = null

  React.useEffect(() => {
    if (editedDoc === null) {
      onEditDocEventListener = Model.on('edit', (eventObj) => {
        const { error, /* document, foundation, */ data } = eventObj
        if (error) {
          return
        }
        editedDocSet(data)
      })
    }
  }, [editedDoc])

  React.useEffect(() => {
    return () => {
      // stop to listen events on component unmount
      Model.stopListenTo(onEditDocEventListener)
      onEditDocEventListener = null
    }
  }, [])
  return [editedDoc]
}

export default onEditDocHook

</code></pre>
<p><code>onDeleteDocHook</code></p>
<pre class="prettyprint source lang-javascript"><code>// onDeleteDocHook.js
import React from 'react'
const onDeleteDocHook = (Model) => {
  const [deletedDoc, deletedDocSet] = React.useState(null)
  let onDeleteDocEventListener = null

  React.useEffect(() => {
    if (deletedDoc === null) {
      onDeleteDocEventListener = Model.on('delete', (eventObj) => {
        const { error, /* document, foundation, */ data } = eventObj
        if (error) {
          return
        }
        deletedDocSet(data)
      })
    }
  }, [deletedDoc])

  React.useEffect(() => {
    return () => {
      // stop to listen events on component unmount
      Model.stopListenTo(onDeleteDocEventListener)
      onDeleteDocEventListener = null
    }
  }, [])
  return [deletedDoc]
}

export default onDeleteDocHook

</code></pre>
<h4>Vue Customer listing component</h4>
<p>The same React Customer listing component above can be written on Vue.js (2.0) following this approach:</p>
<pre class="prettyprint source lang-javascript"><code>&lt;template>
  &lt;main role=&quot;main&quot; class=&quot;col-md-9 ml-sm-auto col-lg-10 px-md-4&quot;>
    &lt;div
      class=&quot;d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 bcustomer-bottom&quot;
    >
      &lt;h1 class=&quot;h2&quot;>Customers&lt;/h1>
      &lt;div class=&quot;btn-toolbar mb-2 mb-md-0&quot;>
        &lt;div class=&quot;btn-group me-2&quot;>
          &lt;router-link  class=&quot;btn btn-sm btn-outline-secondary&quot; to=&quot;/Customers/add&quot; tag=&quot;button&quot;>
             Add new Customer
          &lt;/router-link>
        &lt;/div>
      &lt;/div>
    &lt;/div>
    &lt;div class=&quot;table-responsive&quot;>
      &lt;table class=&quot;table table-striped table-sm&quot;>
        &lt;thead>
          &lt;tr>
            &lt;th>Name&lt;/th>
            &lt;th>E-mail&lt;/th>
            &lt;th>Address&lt;/th>
            &lt;th  align=&quot;right&quot;>Cards&lt;/th>
            &lt;th>-&lt;/th>
          &lt;/tr>
        &lt;/thead>
        &lt;tbody>
          &lt;tr v-for=&quot;doc in this.documents&quot; :key=&quot;doc.__id&quot;>
            &lt;td>{{ doc.name }}&lt;/td>
            &lt;td>{{ doc.email }}&lt;/td>
            &lt;td>{{ doc.address }}&lt;/td>
            &lt;td>{{ doc.cards }}&lt;/td>
            &lt;td>
              &lt;router-link  class=&quot;primary&quot; :to=&quot;`/Customers/edit/${doc.__id}`&quot;>[edit]&lt;/router-link>
               | &lt;a color='primary' @click=&quot;handleDeleteCustomer($event, doc.__id)&quot; href='#'>[delete]&lt;/a>
            &lt;/td>
          &lt;/tr>
        &lt;/tbody>
      &lt;/table>
    &lt;/div>
  &lt;/main>
&lt;/template>

&lt;script>
/* globals */

import swal from 'sweetalert'
import moment from 'moment'

const formatter = new Intl.NumberFormat('en-US', {
  minimumFractionDigits: 2,
  maximumFractionDigits: 2
})

export default {
  name: 'Customers',
  components: {},
  props: {},
  data: () => ({
    documents: []
  }),
  async mounted () {
    const { Customer } = this.$foundation.data

    this.onAddDocHandlerListener = Customer.on('add', this.onAddDocHandler)
    this.onEditDocHandlerListener = Customer.on('edit', this.onEditDocHandler)
    this.onDeleteDocHandlerListener = Customer.on(
      'delete',
      this.onDeleteDocHandler
    )

    const findCustomers = await Customer.find({})
    if (findCustomers.error) {
      return
    }
    if (findCustomers.data) {
      console.log(findCustomers.data)
      this.$set(this, 'documents', findCustomers.data)
    }
  },
  // eslint-disable-next-line vue/no-deprecated-destroyed-lifecycle
  beforeDestroy () {
    const { Customer } = this.$foundation.data
    Customer.stopListenTo(this.onAddDocHandlerListener)
    Customer.stopListenTo(this.onEditDocHandlerListener)
    Customer.stopListenTo(this.onDeleteDocHandlerListener)
  },
  methods: {
    moment () {
      return moment
    },
    swal () {
      return swal
    },
    formatter () {
      return formatter
    },
    onAddDocHandler (eventObj) {
      const { error, document, foundation, data } = eventObj
      console.log({ error, document, foundation, data })
      if (error) {
        return
      }
      this.documents.unshift(data)
    },
    onEditDocHandler (eventObj) {
      const { error, document, foundation, data } = eventObj
      console.log({ error, document, foundation, data })
      this.documents.forEach((doc, index) => {
        if (doc.__id === data.__id) {
          this.$set(this.documents, index, data)
        }
      })
    },
    onDeleteDocHandler (eventObj) {
      const { error, document, foundation, data } = eventObj
      console.log({ error, document, foundation, data })
      this.documents.forEach((doc, index) => {
        if (doc.__id === data.__id) {
          this.documents.splice(index, 1)
        }
      })
    },
    async handleDeleteCustomer(e, ___id) {
      console.log(e, ___id)
      const { Customer } = this.$foundation.data
      e.preventDefault()
      // console.error(___id)
      swal({
        title: 'Are you sure?',
        text: 'Once deleted, you will not be able to recover this!',
        icon: 'warning',
        buttons: true,
        dangerMode: true
      }).then(async (willDelete) => {
        if (willDelete) {
          const r = await Customer.delete(___id)
          // console.error(r)
          if (r.error) {
            swal('Database error', e.error.message, 'error')
            return
          }
          swal('Poof! The order has been deleted!', {
            icon: 'success'
          })
        } else {
          swal('The Customer is safe!')
        }
      })
    }
  }
}
&lt;/script>

</code></pre>
<h2>Application demos</h2>
<h3>React demos</h3>
<h4>React Demo app (Functional components)</h4>
<img src="https://i.imgur.com/b29Lsgj.png" width="600" />
<p><a href="https://voodux-react-functions-demo.vercel.app/"><code>Demo app</code></a></p>
<p><a href="https://github.com/web2solutions/voodux-react-functions-demo"><code>Demo project</code></a></p>
<p><code>Demo documentation:</code> -&gt; TODO</p>
<h4>React Demo app (Context API &amp;&amp; Functional components)</h4>
<img src="https://i.imgur.com/b29Lsgj.png" width="600" />
<p><a href="https://voodux-react-context-api-demo.vercel.app/"><code>Demo app</code></a></p>
<p><a href="https://github.com/web2solutions/voodux-react-context-api-demo"><code>Demo project</code></a></p>
<p><code>Demo documentation:</code> -&gt; TODO</p>
<h4>React Demo app (Class based components)</h4>
<img src="https://i.imgur.com/E1u5g6y.png" width="600" />
<p><a href="https://voodux-react-class-demo.vercel.app/"><code>Demo app</code></a></p>
<p><a href="https://github.com/web2solutions/voodux-react-class-demo"><code>Demo project</code></a></p>
<p><a href="https://web2solutions.github.io/voodux-react-class-demo/"><code>Demo documentation:</code></a></p>
<h3>Vue Demos</h3>
<h4>Demo #1: Vue, Boostrap, Vue Router, VooduX</h4>
<img src="https://i.imgur.com/gGuFnX5.png" width="600" />
<p><a href="https://voodux-vue-simple-demo.vercel.app/"><code>Demo app</code></a></p>
<p><a href="https://github.com/web2solutions/voodux-vue-simple-demo"><code>Demo project</code></a></p>
<p><code>Demo documentation:</code> TODO</p>
<h3>DHTMLX demos</h3>
<h3>Vanilla JS demo #1</h3>
<p class="codepen" data-height="665" data-theme-id="dark" data-default-tab="js,result" data-user="web2solutions" data-slug-hash="MWbEMrb" style="height: 665px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="VooduX - VanillaJS playground">
  <span>See the Pen <a href="https://codepen.io/web2solutions/pen/MWbEMrb">
  VooduX - VanillaJS playground</a> by Eduardo Almeida (<a href="https://codepen.io/web2solutions">@web2solutions</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
<h2>Reasons why I created VooduX</h2>
<h3>What is VooduX</h3>
<blockquote>
<p>VooduX is an underlying <code>agnostic application foundation</code> that easily plugs to your brand new or existing application, built with Vue, React, or whatever. It is a set of tools that makes your data to be persistent and your application to be offline capable since from it initial days with zero configuration and free of any back end implementation.</p>
</blockquote>
<p><strong>It actualy provides:</strong></p>
<ul>
<li>A model layer based on Mongoose which simply persists data accross multiple targets.</li>
<li>A proxy like Data API supporting different data transports</li>
<li>Enforced Data Modeling and Data Entities driven design</li>
<li>Application session</li>
<li>100% offline capable applications</li>
<li>Asynchronous and event driven architecture.</li>
<li>Support to develop database driven applications with no configuration and no backend dependency.</li>
</ul>
<p><strong>Coming soon features:</strong></p>
<ul>
<li>Event Sourcing implementation to track and persist data changes</li>
<li>Trully multi threaded architecture by leveraging web workers. Web applications are originally single threaded applications.</li>
<li>Realtime Data Sync</li>
<li>Plugin based Data Transport to give you the freedom to back your web software with any kind of back end technology</li>
<li>Data Schema generators leveraging OpenAPI speficiations (Swagger) as declarative metadata standard</li>
<li>CRUD interfaces generators targeting React, Vue, DHTMLX and jQwidgets and leveraging OpenAPI speficiations (Swagger) as declarative metadata standard</li>
</ul>
<h3>What VooduX is not?</h3>
<ul>
<li>It does not replace Redux, Mobx, Vuex any any other kind of <code>Application Management</code> abstraction.</li>
<li>It does not cares about how you manage your application state.</li>
<li>It does not cares about which <code>project standard</code>'s framework/library you employ. Vue, React, It does not matters.</li>
<li>It does not cares about the UI framework/library you are employing. The Material UI, Boostrap, Vuetify, Sencha, DHTMLX, Dojo.</li>
</ul>
<h3>Hypotethical use case on a large online app</h3>
<p>Supose the <code>server - back end</code> emits a <a href="https://developer.mozilla.org/pt-BR/docs/Web/API/Server-sent_events/Using_server-sent_events"><code>Server Event</code></a> to connected clients with the following info:</p>
<pre class="prettyprint source lang-javascript"><code> {
   action: 'completed',
   entity: 'Order',
   id: 24455,
   customerId: 3443,
   lineItems: [...[{}]],
   totalPaid: 5430
 }
</code></pre>
<p>Supose you are currently catching your eyes at the Dashboard page in the screen where you have: <code>Last Order Listing</code>, <code>Sales Chart</code> and <code>Total Earns Today</code> badge.</p>
<p>Like this:</p>
<img src="https://i.imgur.com/b29Lsgj.png" width="500" />
<p>You now need to update those components based on the received <a href="https://developer.mozilla.org/pt-BR/docs/Web/API/Server-sent_events/Using_server-sent_events"><code>Server Event</code></a>.</p>
<p>The <code>Recent Orders</code> component displays the name of the customer alongside it address and total paid for that specific order.</p>
<p>In that moment, if you don't have the Customer information inside the <code>Application State Management</code> layer, you need to get it in another place. That is where the <code>Application Data Management</code> abstraction resides.</p>
<p>Traditionaly the main applications implementation rely on directly calling an API, or even use things like the browser <code>localStorage</code> API, which will fails once it data size and complexity grows.</p>
<p><em>Someday in a job interview, when I mentioned about this above scenario, the techinical leader asked me: &quot;Don't you know graphql?&quot; .. In that specific time, I never had used it in production, but I had all the background to explain why that question was so stupid. But I decided stay dumb and look like an idiot. Please don't think you have graphql features on a <code>Event Sourcing</code> implementation. Also, the <code>Event Sourcing</code> pattern is something almost required in any large / distributed application.</em></p>
<p>This is one thing GraphQL claims about:</p>
<blockquote>
<p>Even if a REST API returns only a basic partial, it is still transferring more data, while GraphQL is always aiming for the smallest possible request. In an example, if the client needs a field, they request it, and if the API adds a new field, clients don’t get it, unless it’s being added into the GraphQL query.</p>
</blockquote>
<p>The above assumption is totally true, except when you break the &quot;commercial paradigm&quot; and take a hacker persective of what are the resources you have available. And once you add a data layer to your client side, your GraphQL becomes a <code>white elephant</code>.</p>
<p>If you implement different data transports rather than only supporting classical HTTP requests, then you can eliminate the need for requests that have <code>long response body</code>.</p>
<p>Yes, some <code>evangelists</code> don't like paradigm breaks.</p>
<h3>Not  breaking, but enforcing some relativelly recent paradigms</h3>
<p><code>There is no wheels being reinvented</code>. We are just leveraging well stabilished paradigms and methodologies like <code>Entity Relationship</code>, <code>Data Entities</code>, <code>Actors</code>, <code>Objects</code>, <code>RAD</code>, <code>Component Engineering</code>, <code>Messaging Patterns</code>, <code>2-way data flow over an Event Driven Architecture</code>, <code>Data Caching</code> so on and so forth, to delivery agile produced <code>MVPs</code> that scales since from it initial days.</p>
<p>Going against the most traditional development model, we intoduce a <code>proxy like</code> abstraction relying on IndexedDB as local (front end) database, which is a NoSQL database shipped with every modern browser.</p>
<p>There are some frameworks, like Backbone, and some plugins for React and Vue that aims to use IndexedDb as database, but they are dumb and lazy in terms of data design driven development and validation.</p>
<p>Aditionaly, VooduX abstract some kind of <code>data transporters</code> which is used to produce <code>Client Events</code> and to consume <code>Server Events</code>. Every <code>event</code> has an associated snapshot of the data state in that specific portion of time, which is not used only for <code>Event Sourcing</code>, but also to provide direct <code>bindings</code> for <code>view components reactivity</code>.</p>
<p>Despite the fact that <code>event sourcing</code> and <code>server events</code>, if compared to traditional single pull, long pull or bidirectional HTTP requests, drastically reduces the server side demand, we have also a complete database running on front end.</p>
<p>An <code>Application Data Management</code> abstraction gives you some capabilities such:</p>
<ul>
<li>Do not loose data on network disconnections.</li>
<li>100% offline capable applications.</li>
<li>Drastically reduce server resources dependency.</li>
<li>High performant UI reactivity. Local database queries will be faster than the required latency to reach your remote server (latency does not iinclude the time spent until the server returns the reponse)</li>
</ul>
<h2>Links and references</h2>
<h3>Useful links</h3>
<p>Project related resources:</p>
<ul>
<li><a href="https://web2solutions.github.io/voodux/code/index.html">Techinical Reference</a></li>
<li><a href="https://github.com/web2solutions/voodux">Project repository</a></li>
<li><a href="https://web2solutions.github.io/voodux/reports/unit-testing/cypress-tests-report.html">Unit tests Report</a></li>
<li><a href="https://github.com/web2solutions/voodux/issues">Report an issue</a></li>
</ul>
<h3>Reference</h3>
<p>Knowledge base:</p>
<ul>
<li><a href="https://web.dev/progressive-web-apps/">PWA - Progressive web applications</a></li>
<li><a href="https://en.wikipedia.org/wiki/Single-page_application">SPA - Single Page Applications</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/IndexedDB_API">IndexedDB</a></li>
<li><a href="https://mongoosejs.com/">Mongoose</a></li>
<li><a href="https://developer.mozilla.org/pt-BR/docs/Web/API/Server-sent_events/Using_server-sent_events">Server Side Events</a></li>
<li><a href="https://martinfowler.com/eaaDev/EventSourcing.html">Event Sourcing</a></li>
<li><a href="https://en.wikipedia.org/wiki/Rapid_application_development">RAD - Rapid application development</a></li>
<li><a href="http://www.umsl.edu/~sauterv/analysis/F08papers/View.html">Case tools</a></li>
<li><a href="https://en.wikipedia.org/wiki/Metaprogramming">Metaprogramming</a></li>
<li><a href="https://en.wikipedia.org/wiki/Entity%E2%80%93relationship_model">Entity Relationship Model</a></li>
<li><a href="https://en.wikipedia.org/wiki/Component_engineering">Component Engineering</a></li>
<li><a href="http://iraj.in/journal/journal_file/journal_pdf/3-248-146294887148-54.pdf">Information Systems and Software Engineering - PDF</a></li>
</ul>
<h2>ToDo</h2>
<ol>
<li>REST transport</li>
<li>Websocket transport</li>
<li>Serverless transport (Firebase)</li>
<li>Session layer</li>
<li>Event sourcing</li>
<li>Vue demo</li>
<li>DHTMLX demo</li>
<li>VanilaJS demo</li>
<li>textual search with lunr.</li>
<li>Workbox -&gt; https://developers.google.com/web/tools/workbox/guides/get-started</li>
</ol></article>
    </section>







		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>

	<br><br><br><br>Sponsored by WEB2 Solutions


	<span class="copyright">
	Eduardo Almeida
	</span>

<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a>
	
		on 2021-02-24T01:55:55-03:00
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : true,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>